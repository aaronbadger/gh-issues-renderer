<!DOCTYPE html>
<html lang="en">
   <head>
      <meta charset="UTF-8">
      <meta name="viewport" content="width=device-width, initial-scale=1.0">
      <title>A Simple GH Issue Renderer</title>
      <!-- Add your external CSS file for general styling -->
      <link rel="stylesheet" href="mystyle.css">
      <!-- Add a modern font (Roboto) from Google Fonts -->
      <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@400;700&display=swap" rel="stylesheet">
      <!-- Add external CSS specific to React components -->
      <link rel="stylesheet" href="react-components.css">
      <!-- Add additional meta tags or other header content as needed -->
      <script type="module">
         import marked from 'https://unpkg.com/marked@2.0.0/lib/marked.esm.js'
         import {React, ReactDOM} from 'https://unpkg.com/es-react@16.13.1'
         import htm from 'https://unpkg.com/htm?module'
         import { endpoint } from 'https://cdn.skypack.dev/@octokit/endpoint'
         
            const TOKEN = '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'
         const html = htm.bind(React.createElement)
            
         const Posts = (props) => {
         	const [issues, setIssues] = React.useState([])
         	React.useEffect(() => {
                async function fetchIssues() {
                  const { url, ...options } = endpoint('GET /repos/:owner/:repo/issues', {
                    owner: 'aaronbadger',
                    repo: 'gh-issues-renderer',
                    auth: TOKEN,
                  });
                  const response = await fetch(url, options)
                  const issues = await response.json()
                  setIssues(issues)
                }
                fetchIssues()
              }, [])
              const {search} = window.location
              // Add an event listener to handle the click on each header
         function handleHeaderClick(event) {
         const target = event.currentTarget;
         const body = target.nextElementSibling;
         
         // Toggle the visibility of the body content
         if (body.style.display === 'none') {
          body.style.display = 'block';
         } else {
          body.style.display = 'none';
         }
         }
         
         // Define the template for each issue
         function issueTemplate(issue) {
         return html`
          <div>
            <h2 onclick=${handleHeaderClick}>
              <a href="?${issue.number}">${issue.title}</a>
            </h2>
            <div style="display: none;" dangerouslySetInnerHTML="${{ __html: marked(issue.body) }}" />
          </div>
         `;
         }
         
         // Render the issues
         return html`
         <div>
          ${issues
            .filter(({ number }) => !search || Number(search.slice(1)) === number)
            .map(issueTemplate)}
         </div>
         `;
                  })}
              `
            }
         ReactDOM.render(html` <${Posts} /> `, document.body)
      </script>
   </head>
   <body>	</body>
</html>
